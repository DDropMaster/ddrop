<Window x:Class="DDrop.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:pixelDrawer="clr-namespace:DDrop.Controls.PixelDrawer;assembly=DDrop.Controls"
        xmlns:zoomborder="clr-namespace:DDrop.Controls.Zoomborder;assembly=DDrop.Controls"
        xmlns:scatterPlot="clr-namespace:DDrop.Controls.ScatterPlot;assembly=DDrop.Controls"
        xmlns:simpleSample="clr-namespace:SimpleSample;assembly=DDrop.Controls"
        xmlns:loadingSpinner="clr-namespace:DDrop.Controls.LoadingSpinner;assembly=DDrop.Controls"
        xmlns:properties="clr-namespace:DDrop.Properties"
        xmlns:dataGrid="clr-namespace:DDrop.Utility.DataGrid;assembly=DDrop.Utility"
        xmlns:markUp="clr-namespace:DDrop.Utility.MarkupExtensions;assembly=DDrop.Utility"
        xmlns:extToolkit="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:models="clr-namespace:DDrop.BE.Models;assembly=DDrop.BE"
        xmlns:controls1="clr-namespace:DDrop.Controls.AutoComplete.Controls;assembly=DDrop.Controls"
        xmlns:enums="clr-namespace:DDrop.BE.Enums;assembly=DDrop.BE"
        UseLayoutRounding="True"
        mc:Ignorable="d"
        Title="DDrop" MinHeight="630" MinWidth="870" Height="768" Width="1152" Icon="../Resources/Icons/MainIcon.png"
        WindowState="Maximized" x:Name="AppMainWindow" Closing="AppMainWindow_Closing"
        WindowStartupLocation="CenterScreen"
        SizeChanged="MainWindow_OnSizeChanged" >
    <Grid>
        <TabControl x:Name="MainTabControl" SelectionChanged="Selector_OnSelectionChanged" Margin="10,37,10,47">
            <TabItem Name="SeriesManager" Header="Менеджер Серий">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Border x:Name="SeriesManagerMenuBar" Grid.Column="0" Grid.Row="0" Background="Gainsboro"
                            BorderThickness="1" Height="41" Margin="10,10,10,0" VerticalAlignment="Top">
                        <Grid>
                            <Button Grid.Column="0" Grid.Row="0" Name="AddSeriesButton" HorizontalAlignment="Left"
                                    VerticalAlignment="Top" Width="28" BorderBrush="{x:Null}" Background="{x:Null}"
                                    Height="26" Click="AddNewSeries_OnClick" Margin="10,6,0,0"
                                    ToolTip="Добавить серию.">
                                <ContentControl Content="{StaticResource AddIcon}" Height="22" Width="23" />
                            </Button>
                            <TextBox Grid.Column="0" Grid.Row="0" Name="OneLineSetterValue" Height="19"
                                     VerticalAlignment="Top" Margin="43,10,241,0" />
                            <Button ToolTip="Создать Excel отчет" Grid.Column="0" Grid.Row="0"
                                    Name="ExportSeriesButton" BorderBrush="{x:Null}" Background="{x:Null}"
                                    Click="ExportSeriesButton_Click" Margin="0,6,43,7" HorizontalAlignment="Right"
                                    Width="28">
                                <ContentControl Content="{StaticResource FileExport}" Height="22" Width="23" />
                            </Button>
                            <Button ToolTip="Удалить серию." Grid.Column="0" Grid.Row="0" x:Name="DeleteSeriesButton"
                                    BorderBrush="{x:Null}" Background="{x:Null}" Click="DeleteSeriesButton_Click"
                                    Margin="0,6,10,7" HorizontalAlignment="Right" Width="28">
                                <ContentControl Content="{StaticResource DeleteIcon}" Height="22" Width="23" />
                            </Button>
                            <Button ToolTip="Загрузить серии с компьютера" Grid.Column="0" Grid.Row="0"
                                    x:Name="ImportLocalSeries" BorderBrush="{x:Null}" Background="{x:Null}"
                                    Click="ImportLocalSeries_ClickAsync" Margin="0,6,76,7" HorizontalAlignment="Right"
                                    Width="28" RenderTransformOrigin="-1.25,0.615">
                                <ContentControl Content="{StaticResource ImportLocalSeries}" Height="22" Width="23" />
                            </Button>
                            <Button ToolTip="Выгрузить серии на компьютер" Grid.Column="0" Grid.Row="0"
                                    x:Name="ExportSeriesLocal" BorderBrush="{x:Null}" Background="{x:Null}"
                                    Click="ExportSeriesLocal_ClickAsync" Margin="0,6,109,0" HorizontalAlignment="Right"
                                    Width="28" RenderTransformOrigin="-1.25,0.615" Height="26" VerticalAlignment="Top">
                                <ContentControl Content="{StaticResource ExoportLocalSeries}" Height="22" Width="23" />
                            </Button>
                        </Grid>
                    </Border>
                    <Border Grid.Column="0" Grid.Row="0" BorderThickness="1" BorderBrush="#34558b" Margin="10,56,10,10">
                        <loadingSpinner:AdornedControl Name="SeriesLoading">
                            <loadingSpinner:AdornedControl.AdornerContent>
                                <simpleSample:LoadingWait />
                            </loadingSpinner:AdornedControl.AdornerContent>

                            <DataGrid ColumnWidth="*" CellEditEnding="SeriesDataGrid_CellEditEnding"
                                      CanUserAddRows="false" IsReadOnly="False" AutoGenerateColumns="False"
                                      SelectionMode="Single" Margin="0" BorderThickness="0" ClipToBounds="True"
                                      ItemsSource="{Binding User.UserSeries}"
                                      CanUserSortColumns="False"
                                      SelectionChanged="SeriesDataGrid_OnSelectionChanged" Name="SeriesDataGrid">
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter Property="Background"
                                                        Value="#dde0eb" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridCheckBoxColumn Width="25" IsReadOnly="False"
                                                            Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                                            CanUserResize="False">
                                        <DataGridCheckBoxColumn.HeaderTemplate>
                                            <DataTemplate>
                                                <CheckBox
                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=AllSelectedSeries}"
                                                    x:Name="ChooseAllSeries" Height="15" />
                                            </DataTemplate>
                                        </DataGridCheckBoxColumn.HeaderTemplate>
                                    </DataGridCheckBoxColumn>
                                    <DataGridTextColumn IsReadOnly="False" Header="Серия" Binding="{Binding Title}" />
                                    <DataGridTextColumn IsReadOnly="True" Header="Интервал между снимками"
                                                        Binding="{Binding IntervalBetweenPhotos}" />
                                    <DataGridTextColumn IsReadOnly="True" Header="Время добавления"
                                                        Binding="{Binding AddedDate}" />
                                    <DataGridTemplateColumn>
                                        <DataGridTemplateColumn.Header>Вещество</DataGridTemplateColumn.Header>
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <controls1:TextBoxAutoComplete
                                                    SaveClick="TextBoxAutoComplete_OnSaveClick"
                                                    DeleteClick="TextBoxAutoComplete_OnDeleteClick"
                                                    IsDeleteEnabled="{Binding IsSubstanceExists, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                    Name="autoTxtBoxEng"
                                                    ExistingValue="{Binding Substance.CommonName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                    SelectedListBoxItem="{Binding Substance, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}"
                                                    SavedValue="{Binding Sub, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                    IsEdited="{Binding IsSubstanceEdited, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                    SearchDataProvider="{Binding ElementName=AppMainWindow, Path=SubstancesDataProvider}" 
                                                />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Width="35" IsReadOnly="True" CanUserResize="False">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Name="DeleteSingleInputPhotoButton" HorizontalAlignment="Left"
                                                        VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="DeleteSingleSeriesButton_Click">
                                                    <ContentControl Content="{StaticResource DeleteIcon}" Height="20" />
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridCheckBoxColumn Width="85" IsReadOnly="False"
                                                            Binding="{Binding Settings.GeneralSeriesSettings.IsAcoustic, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                            CanUserResize="False" Header="Акустическая">
                                        <DataGridCheckBoxColumn.CellStyle>
                                            <Style>
                                                <EventSetter Event="CheckBox.Checked" Handler="OnAcousticChecked"/>
                                            </Style>
                                        </DataGridCheckBoxColumn.CellStyle>
                                    </DataGridCheckBoxColumn>
                                    <DataGridTemplateColumn Width="45" Header="Статус" IsReadOnly="True"
                                                            CanUserResize="False">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <TextBlock x:Name="PhotosStatusToolTip"
                                                               ToolTip="Чтобы построить график, необходимо указать интервал между снимками, рассчитать радиус и(или) температуру для каждой фотографии серии."
                                                               Height="25" Width="25" />
                                                    <ContentControl x:Name="PhotosStatus"
                                                                    ToolTip="Измерения должны быть обработаны, чтобы построить график."
                                                                    Content="{StaticResource Warning}" Height="25"
                                                                    Width="25" HorizontalAlignment="Center" />
                                                </Grid>
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding CanDrawPlot}" Value="true">
                                                        <Setter Property="Content" Value="{StaticResource Ok}"
                                                                TargetName="PhotosStatus" />
                                                        <Setter Property="ToolTip" Value="График может быть построен."
                                                                TargetName="PhotosStatusToolTip" />
                                                        <Setter Property="ToolTip" Value="График может быть построен."
                                                                TargetName="PhotosStatus" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Button
                                                        Background="Transparent"
                                                        x:Name="PhotosCommentToolTip"
                                                        ToolTip="Добавить комментарий."
                                                        Height="25" Width="25"
                                                        Click="PhotosCommentToolTip_OnClick">
                                                        <ContentControl x:Name="PhotosComment"
                                                               ToolTip="Добавить комментарий."
                                                               Content="{StaticResource AddComment}" Height="25"
                                                               Width="25" HorizontalAlignment="Center" />
                                                    </Button>
                                                </Grid>
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                        <Setter Property="Content" Value="{StaticResource CommentAdded}"
                                                                TargetName="PhotosComment" />
                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                TargetName="PhotosCommentToolTip" />
                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                TargetName="PhotosComment" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </loadingSpinner:AdornedControl>
                    </Border>
                    <GridSplitter HorizontalAlignment="Stretch"
                                  VerticalAlignment="Center"
                                  Grid.Column="0"
                                  Grid.Row="1" ResizeBehavior="PreviousAndNext"
                                  Height="5" />

                    <DataGrid ColumnWidth="*" AutoGenerateColumns="False" IsReadOnly="True" Grid.Column="0"
                              Grid.Row="2" Margin="10" ItemsSource="{Binding User.UserSeries.PhotoSeries}"
                              Name="SeriesPreviewDataGrid" SelectionChanged="SeriesPreviewDataGrid_SelectionChanged" CanUserSortColumns="False">
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver"
                                             Value="True">
                                        <Setter Property="Background"
                                                Value="#dde0eb" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Измерение" Binding="{Binding Name}" />
                            <DataGridTextColumn 
                                IsReadOnly="True" Header="Радиус, м"
                                Binding="{Binding Drop.RadiusInMeters}">
                            </DataGridTextColumn>
                            <DataGridTextColumn 
                                IsReadOnly="True" Header="Объем, м³"
                                Binding="{Binding Drop.VolumeInCubicalMeters}"/>
                            <DataGridTextColumn 
                                IsReadOnly="True" Header="Температура, °С"
                                Binding="{Binding Drop.Temperature}"/>
                            <DataGridTextColumn 
                                IsReadOnly="True" Header="Температура ОС, °С"
                                Binding="{Binding AmbientTemperature}"/>
                            <DataGridTextColumn Header="Время добавления" Binding="{Binding AddedDate}" />
                            <DataGridTextColumn Header="Время создания" Binding="{Binding CreationDateTime}" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <GridSplitter HorizontalAlignment="Center"
                                  VerticalAlignment="Stretch"
                                  Grid.Column="1"
                                  Grid.Row="0"
                                  Grid.RowSpan="3" ResizeBehavior="PreviousAndNext"
                                  Width="5" />
                    <loadingSpinner:AdornedControl Grid.Row="0" Grid.Column="2" Grid.RowSpan="3" Name="PreviewLoading">
                        <loadingSpinner:AdornedControl.AdornerContent>
                            <simpleSample:LoadingWait />
                        </loadingSpinner:AdornedControl.AdornerContent>
                        <zoomborder:ZoomBorder HorizontalAlignment="Stretch" x:Name="CgsImagePreviewViewer"
                                               ClipToBounds="True" Background="Gray" Margin="10" Grid.RowSpan="3">
                            <Canvas x:Name="PreviewCanvas">
                                <Image x:Name="ImgPreview" VerticalAlignment="Center" HorizontalAlignment="Center"
                                       Width="{Binding Source.PixelWidth,RelativeSource={RelativeSource Self}}"
                                       Height="{Binding Source.PixelHeight,RelativeSource={RelativeSource Self}}"
                                       Stretch="Uniform" />
                            </Canvas>
                        </zoomborder:ZoomBorder>
                    </loadingSpinner:AdornedControl>
                </Grid>
            </TabItem>
            <TabItem Name="SingleSeries" IsEnabled="False">
                <TabItem.Style>
                    <Style TargetType="{x:Type TabItem}">
                        <Setter Property="Header" Value="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Title}" />
                        <Setter Property="HeaderStringFormat" Value="Серия {0}" />
                        <Style.Triggers>
                            <DataTrigger
                                Binding="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Title.Length, FallbackValue=0, TargetNullValue=0}"
                                Value="0">
                                <Setter Property="Header" Value="" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TabItem.Style>
                <Grid>
                    <TabControl x:Name="SingleSeriesTabControl" Margin="10,10,10,5">
                        <TabItem x:Name="PhotosTab" Header="Измерения">
                            <Grid x:Name="PhotosGrid" Background="#FFE5E5E5" RenderTransformOrigin="0.56,0.503" Loaded="PhotosGrid_OnLoaded">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="0" MaxWidth="300" x:Name="AutoCalculationColumn" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*" x:Name="PhotosPreviewRow" />
                                </Grid.RowDefinitions>
                                <Border Background="Gainsboro" BorderThickness="1" Height="42" Margin="10,10,10,0"
                                        VerticalAlignment="Top">
                                    <Grid>
                                        <Grid x:Name="SeriesEditMenu" Visibility="Visible">
                                            <Button Grid.Row="0" Grid.Column="0" Name="AddPhotoButton"
                                                    HorizontalAlignment="Left" Margin="10,6,0,0"
                                                    VerticalAlignment="Top" Width="28" BorderBrush="{x:Null}"
                                                    Background="{x:Null}" Height="26"
                                                    Click="MenuItemChoosePhotos_OnClick"
                                                    ToolTip="Добавить фотографии для серии.">
                                                <ContentControl Content="{StaticResource AddIcon}" Height="22"
                                                                Width="24" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="DeleteInputPhotosButton"
                                                    HorizontalAlignment="Left" Margin="43,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="DeleteInputPhotos_OnClick"
                                                    ToolTip="Удалить фотографии для серии.">
                                                <ContentControl Content="{StaticResource DeleteIcon}" Height="21"
                                                                Width="23" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="EditPhotosOrder"
                                                    HorizontalAlignment="Left" Margin="75,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="27" Click="EditPhotosOrder_OnClick"
                                                    ToolTip="Редактировать порядок фотографий.">
                                                <ContentControl Content="{StaticResource EditTable}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="ReCalculate"
                                                    HorizontalAlignment="Left" Margin="107,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="27" Click="ReCalculate_Click"
                                                    ToolTip="Пересчитать параметры капель.">
                                                <ContentControl Content="{StaticResource ReCalculate}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="StartAutoCalculate"
                                                    HorizontalAlignment="Left" Margin="139,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="27"
                                                    Click="StartAutoCalculate_OnClick"
                                                    ToolTip="Начать автоматический расчет.">
                                                <ContentControl Content="{StaticResource Play}" Height="22" />
                                            </Button>
                                            <TextBox IsEnabled="False" x:Name="IntervalBetweenPhotos"
                                                     Text="{Binding ElementName=AppMainWindow, Path=CurrentSeries.IntervalBetweenPhotos}"
                                                     Height="20" Margin="0,0,42,0" TextWrapping="Wrap"
                                                     VerticalAlignment="Top" HorizontalAlignment="Right" Width="115" />
                                            <Label Content="Интервал между снимками (c):" Margin="0,-4,162,0"
                                                   VerticalAlignment="Top" Height="27" Background="{x:Null}"
                                                   HorizontalAlignment="Right" Width="180" />
                                            <CheckBox Name="CreationTimeCheckBox"
                                                      IsChecked="{Binding CurrentSeries.Settings.GeneralSeriesSettings.UseCreationDateTime, ElementName=AppMainWindow,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                      Checked="CreationTimeCheckBox_Checked"
                                                      Unchecked="CreationTimeCheckBox_Unchecked"
                                                      Content="Использовать время создания снимка" Margin="0,21,347,0"
                                                      HorizontalAlignment="Right" Width="245" />
                                            <CheckBox Name="UseThermalPlotCheckBox"
                                                      IsChecked="{Binding CurrentSeries.Settings.GeneralSeriesSettings.UseThermalPlot, ElementName=AppMainWindow,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                      Checked="UseThermalPlotCheckBox_OnChecked"
                                                      Unchecked="UseThermalPlotCheckBox_OnUnchecked"
                                                      Content="Использовать температурный график" Margin="0,2,347,19"
                                                      HorizontalAlignment="Right" Width="245" />
                                            <Button Grid.Row="0" Grid.Column="0" Name="EditIntervalBetweenPhotos"
                                                    HorizontalAlignment="Right" Margin="0,-4,10,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="EditIntervalBetweenPhotos_Click"
                                                    ToolTip="Редактировать интервал между снимками.">
                                                <ContentControl Content="{StaticResource EditIcon}" Height="21"
                                                                Width="23" />
                                            </Button>
                                            <Button Visibility="Hidden" Grid.Row="0" Grid.Column="0"
                                                    Name="SaveIntervalBetweenPhotos" HorizontalAlignment="Right"
                                                    Margin="0,6,10,0" VerticalAlignment="Top" Width="27"
                                                    Background="{x:Null}" BorderBrush="{x:Null}" Height="26"
                                                    Click="SaveIntervalBetweenPhotos_Click"
                                                    ToolTip="Сохранить интервал между снимками.">
                                                <ContentControl Content="{StaticResource SaveIcon}" Height="21"
                                                                Width="23" />
                                            </Button>
                                            <Label Content="Количество измерений:" Margin="0,15,162,-2"
                                                VerticalAlignment="Top" Height="27" Background="{x:Null}"
                                                HorizontalAlignment="Right" Width="180" HorizontalContentAlignment="Right" />
                                            <Label Content="{Binding MeasurementsSeries.Count}" Margin="0,15,10,-2"
                                                   VerticalAlignment="Top" Height="27" Background="{x:Null}"
                                                   HorizontalAlignment="Right" Width="152" />
                                        </Grid>
                                        <Grid x:Name="AutoCalculationMenu" Visibility="Hidden">
                                            <Button Grid.Row="0" Grid.Column="0" Name="AutoCalculate"
                                                    HorizontalAlignment="Left" Margin="10,6,0,0"
                                                    VerticalAlignment="Top" Width="28" BorderBrush="{x:Null}"
                                                    Background="{x:Null}" Height="26" Click="Calculate_OnClick"
                                                    ToolTip="Рассчитать.">
                                                <ContentControl Content="{StaticResource Play}" Height="22" Width="24" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="CheckNextNotCalculated"
                                                    HorizontalAlignment="Left" Margin="175,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="27" Click="CheckNextNotCalculated_OnClick"
                                                    ToolTip="Выбрать необработанные снимки.">
                                                <ContentControl Content="{StaticResource EditTable}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="DiscardCalculationResults"
                                                    HorizontalAlignment="Left" Margin="75,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="DiscardCalculationResults_OnClick"
                                                    ToolTip="Закончить расчет">
                                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                                Width="23" />
                                            </Button>
                                        </Grid>
                                        <Grid x:Name="SavePhotoOrderMenu" Visibility="Hidden">
                                            <Button Visibility="Visible" Grid.Row="0" Name="SavePhotosOrder"
                                                    HorizontalAlignment="Left" VerticalAlignment="Top" Width="27"
                                                    Background="{x:Null}" BorderBrush="{x:Null}" Height="25"
                                                    Click="SavePhotosOrder_OnClick" ToolTip="Сохранить изменения."
                                                    Margin="10,6,0,0">
                                                <ContentControl Content="{StaticResource SaveIcon}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="DiscardPhotosReOrder"
                                                    HorizontalAlignment="Left" Margin="43,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="DiscardPhotosReOrder_OnClick"
                                                    ToolTip="Закончить изменение порядка снимков.">
                                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                                Width="23" />
                                            </Button>
                                        </Grid>
                                        <Grid x:Name="ManualEditMenu" Visibility="Hidden">
                                            <Button Grid.Row="0" Name="SaveInputPhotoEditButton"
                                                    HorizontalAlignment="Left" Margin="10,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="25"
                                                    Click="SaveInputPhotoEditButton_Click"
                                                    ToolTip="Сохранить изменения.">
                                                <ContentControl Content="{StaticResource SaveIcon}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="DiscardManualPhotoEdit"
                                                    HorizontalAlignment="Left" Margin="43,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="DiscardManualPhotoEdit_OnClick"
                                                    ToolTip="Закончить ручное редактирование.">
                                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                                Width="23" />
                                            </Button>
                                            <TextBox IsEnabled="False"
                                                     Text="{Binding ElementName=AppMainWindow, Path=CurrentDropPhoto.XDiameterInPixels}"
                                                     Name="PixelsInMillimeterHorizontalTextBox" Height="20"
                                                     Margin="0,10,131,0" TextWrapping="Wrap" VerticalAlignment="Top"
                                                     HorizontalAlignment="Right" Width="84" />
                                            <TextBox IsEnabled="False"
                                                     Text="{Binding ElementName=AppMainWindow, Path=CurrentDropPhoto.ZDiameterInPixels}"
                                                     Name="PixelsInMillimeterZTextBox" Height="20"
                                                     Margin="0,10,131,0" TextWrapping="Wrap" VerticalAlignment="Top"
                                                     HorizontalAlignment="Right" Width="84" />
                                            <Label Name="PixelsInMillimeterLabel" Content="Пикселей в миллиметре:" Margin="0,10,252,0"
                                                   VerticalAlignment="Top" Height="20" Background="{x:Null}"
                                                   FontSize="8" HorizontalAlignment="Right" Width="101" />
                                            <ToggleButton Checked="HorizontalRulerToggleButton_Checked"
                                                          Unchecked="HorizontalRulerToggleButton_Unchecked"
                                                          x:Name="HorizontalRulerToggleButton" Grid.Row="0"
                                                          Margin="0,7,220,0" VerticalAlignment="Top"
                                                          Background="{x:Null}" BorderBrush="{x:Null}"
                                                          ToolTip="Провести горизонтальную линию." Height="24"
                                                          HorizontalAlignment="Right" Width="27">
                                                <ContentControl Content="{StaticResource Rule}" Height="20"
                                                                RenderTransformOrigin="0.5,0.5">
                                                    <ContentControl.RenderTransform>
                                                        <TransformGroup>
                                                            <RotateTransform Angle="45" />
                                                        </TransformGroup>
                                                    </ContentControl.RenderTransform>
                                                </ContentControl>
                                            </ToggleButton>
                                            <TextBox IsEnabled="False"
                                                     Text="{Binding ElementName=AppMainWindow, Path=CurrentDropPhoto.YDiameterInPixels}"
                                                     x:Name="PixelsInMillimeterVerticalTextBox" Height="20"
                                                     Margin="0,10,10,0" TextWrapping="Wrap" VerticalAlignment="Top"
                                                     HorizontalAlignment="Right" Width="84" />
                                            <ToggleButton Checked="VerticalRulerToggleButton_Checked"
                                                          Unchecked="VerticalRulerToggleButton_Unchecked"
                                                          x:Name="VerticalRulerToggleButton" Grid.Row="0"
                                                          Margin="0,7,89,0" VerticalAlignment="Top"
                                                          Background="{x:Null}" BorderBrush="{x:Null}" Height="25"
                                                          ToolTip="Провести вертикальную линию."
                                                          HorizontalAlignment="Right" Width="27">
                                                <ContentControl Content="{StaticResource Rule}" Height="21"
                                                                RenderTransformOrigin="0.5,0.5">
                                                    <ContentControl.RenderTransform>
                                                        <TransformGroup>
                                                            <RotateTransform Angle="135" />
                                                        </TransformGroup>
                                                    </ContentControl.RenderTransform>
                                                </ContentControl>
                                            </ToggleButton>
                                        </Grid>
                                        <Grid x:Name="ManualThermalEditMenu" Visibility="Hidden">
                                            <Button Grid.Row="0" Name="SaveThermalPhotoEditButton"
                                                    HorizontalAlignment="Left" Margin="10,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="25"
                                                    Click="SaveThermalPhotoEditButton_OnClick"
                                                    ToolTip="Сохранить изменения.">
                                                <ContentControl Content="{StaticResource SaveIcon}" Height="21" />
                                            </Button>
                                            <Button Grid.Row="0" Grid.Column="0" Name="DiscardThermalPhotoEdit"
                                                    HorizontalAlignment="Left" Margin="43,6,0,0"
                                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                                    BorderBrush="{x:Null}" Height="26"
                                                    Click="DiscardThermalPhotoEdit_OnClick"
                                                    ToolTip="Закончить ручное редактирование.">
                                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                                Width="23" />
                                            </Button>
                                            <TextBox IsEnabled="False"
                                                     Text="{Binding ElementName=AppMainWindow, Path=CurrentMeasurement.Drop.Temperature}"
                                                     Name="TemperatureTextBox" Height="20"
                                                     Margin="0,10,10,0" TextWrapping="Wrap" VerticalAlignment="Top"
                                                     HorizontalAlignment="Right" Width="84" />
                                            <Label Name="TemperatureLabel" Content="Температура:" Margin="0,10,50,0"
                                                   VerticalAlignment="Top" Height="20" Background="{x:Null}"
                                                   FontSize="8" HorizontalAlignment="Right" Width="101" />
                                        </Grid>
                                    </Grid>
                                </Border>
                                <Grid Grid.Row="0" Grid.Column="0" x:Name="PhotosTableControls">
                                    <loadingSpinner:AdornedControl Name="CurrentSeriesPhotoContentLoading"
                                                                   Margin="0,60,0,0">
                                        <loadingSpinner:AdornedControl.AdornerContent>
                                            <simpleSample:LoadingWait />
                                        </loadingSpinner:AdornedControl.AdornerContent>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*" x:Name="PhotosRow"/>
                                                <RowDefinition Height="Auto" x:Name="PhotosRowSplitter"/>
                                                <RowDefinition Height="100" x:Name="PhotosDetailsRow"/>
                                                <RowDefinition Height="62" x:Name="ThermalPhotoRow"/>
                                                <RowDefinition Height="8" x:Name="ThermalRowSplitter"/>
                                            </Grid.RowDefinitions>
                                            <DataGrid Grid.Row="0" ColumnWidth="*" dataGrid:VisualHelper.EnableRowsMove="False"
                                                      CellEditEnding="Photos_CellEditEnding" CanUserSortColumns="False"
                                                      CanUserAddRows="false" AutoGenerateColumns="false"
                                                      HorizontalAlignment="Stretch" Name="Photos" Margin="10,0,10,5"
                                                      SelectionMode="Single" SelectionChanged="Photos_SelectionChanged"
                                                      IsReadOnly="False"
                                                      ItemsSource="{Binding CurrentSeries.MeasurementsSeries, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}">
                                                <DataGrid.RowStyle>
                                                    <Style TargetType="DataGridRow">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                 Value="True">
                                                                <Setter Property="Background"
                                                                    Value="#dde0eb" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGrid.RowStyle>
                                                <DataGrid.Columns>
                                                    <DataGridCheckBoxColumn Width="25" x:Name="PhotosCheckedColumn"
                                                                        IsReadOnly="False"
                                                                        Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                                                        CanUserResize="False">
                                                        <DataGridCheckBoxColumn.HeaderTemplate>
                                                            <DataTemplate>
                                                                <CheckBox
                                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=AllSelectedPhotos}"
                                                                    x:Name="ChooseAllSeries" Height="15" />
                                                            </DataTemplate>
                                                        </DataGridCheckBoxColumn.HeaderTemplate>
                                                    </DataGridCheckBoxColumn>
                                                    <DataGridTextColumn IsReadOnly="False" Header="Измерение"
                                                                    Binding="{Binding Name}" />
                                                    <DataGridTextColumn 
                                                        IsReadOnly="True" Header="X диаметр, м"
                                                        Binding="{Binding Drop.XDiameterInMeters}" />
                                                    <DataGridTextColumn 
                                                        IsReadOnly="True" Header="Y диаметр, м"
                                                        Binding="{Binding Drop.YDiameterInMeters}"/>
                                                    <DataGridTextColumn 
                                                        IsReadOnly="True" Header="Z диаметр, м"
                                                        Binding="{Binding Drop.ZDiameterInMeters}" />
                                                    <DataGridTextColumn 
                                                        IsReadOnly="True" Header="Радиус, м"
                                                        Binding="{Binding Drop.RadiusInMeters}" />
                                                    <DataGridTextColumn 
                                                        IsReadOnly="True" Header="Объем, м³"
                                                        Binding="{Binding Drop.VolumeInCubicalMeters}"/>
                                                    <DataGridTextColumn 
                                                        IsReadOnly="False" Header="Температура, °С"
                                                        Binding="{Binding Drop.Temperature}"/>
                                                    <DataGridTextColumn 
                                                        IsReadOnly="False" Header="Температура ОС, °С"
                                                        Binding="{Binding AmbientTemperature}"/>
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время добавления"
                                                                    Binding="{Binding AddedDate}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время создания"
                                                                    Binding="{Binding CreationDateTime}" />
                                                    <DataGridTemplateColumn Width="30" x:Name="DeleteMeasurementColumn"
                                                                        IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Name="DeleteSingleInputPhotoButton"
                                                                    HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                    Width="27" Background="{x:Null}"
                                                                    BorderBrush="{x:Null}" Height="25"
                                                                    Click="DeleteSingleMeasurement">
                                                                    <ContentControl Content="{StaticResource DeleteIcon}"
                                                                                Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="45" Header="Статус" IsReadOnly="True"
                                                                        CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate DataType="models:Measurement">
                                                                <Grid>
                                                                    <TextBlock x:Name="PhotosStatusToolTip"
                                                                           ToolTip="Измерение должно быть обработано, чтобы построить график."
                                                                           Height="25" Width="25" />
                                                                    <ContentControl x:Name="PhotosStatus"
                                                                                ToolTip="Измерение должно быть обработано, чтобы построить график."
                                                                                Content="{StaticResource Warning}"
                                                                                Height="25" Width="25"
                                                                                HorizontalAlignment="Center" />
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Processed}" Value="true">
                                                                        <Setter Property="Content"
                                                                            Value="{StaticResource Ok}"
                                                                            TargetName="PhotosStatus" />
                                                                        <Setter Property="ToolTip"
                                                                            Value="Измерение обработано успешно."
                                                                            TargetName="PhotosStatusToolTip" />
                                                                        <Setter Property="ToolTip"
                                                                            Value="Измерение обработано успешно."
                                                                            TargetName="PhotosStatus" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Grid>
                                                                    <Button
                                                                        Background="Transparent"
                                                                        x:Name="MeasurementCommentToolTip"
                                                                        ToolTip="Добавить комментарий."
                                                                        Height="25" Width="25"
                                                                        Click="MeasurementCommentToolTip_OnClick">
                                                                        <ContentControl x:Name="MeasurementComment"
                                                                           ToolTip="Добавить комментарий."
                                                                           Content="{StaticResource AddComment}" Height="25"
                                                                           Width="25" HorizontalAlignment="Center" />
                                                                    </Button>
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                                        <Setter Property="Content" Value="{StaticResource CommentAdded}"
                                                                            TargetName="MeasurementComment" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="MeasurementCommentToolTip" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="MeasurementComment" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                            <GridSplitter
                                                IsEnabled="False"
                                                x:Name="MeasurementsPhotosSplitter"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Center"
                                                Grid.Row="1" Grid.Column="0" ResizeBehavior="PreviousAndNext"
                                                Height="5" />
                                            <DataGrid 
                                                dataGrid:SingleSelectionGroup.GroupName="A"
                                                Grid.Row="2"
                                                Name="PhotosDetails"
                                                Margin="10,5,10,10" 
                                                HorizontalAlignment="Stretch" 
                                                SelectionMode="Single" IsReadOnly="False"
                                                CellEditEnding="PhotosDetails_OnCellEditEnding"
                                                CanUserSortColumns="False"
                                                CanUserAddRows="false" AutoGenerateColumns="false"
                                                ItemsSource="{Binding CurrentMeasurement.DropPhotos, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True}"
                                                SelectionChanged="PhotosDetails_OnSelectionChanged" RenderTransformOrigin="0.5,0.5">
                                                <DataGrid.RowStyle>
                                                    <Style TargetType="DataGridRow">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="#dde0eb" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGrid.RowStyle>
                                                <DataGrid.Columns>
                                                    <DataGridTemplateColumn Width="30" x:Name="AddRegularPhotoColumn"
                                                                                        IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Name="AddRegularPhoto"
                                                                                    HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                                    Width="27" Background="{x:Null}"
                                                                                    BorderBrush="{x:Null}" Height="25"
                                                                                    Click="AddDropPhoto_OnClick">
                                                                    <ContentControl Content="{StaticResource AddIcon}"
                                                                                                Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTextColumn IsReadOnly="False" Header="Снимок"
                                                                                    Binding="{Binding Name}" />
                                                    <DataGridTextColumn IsReadOnly="True"
                                                                                Header="X диаметр, px"
                                                                                Binding="{Binding XDiameterInPixels}" />
                                                    <DataGridTextColumn IsReadOnly="True" 
                                                                                Header="Y диаметр, px"
                                                                                Binding="{Binding YDiameterInPixels}" />
                                                    <DataGridTextColumn IsReadOnly="True"
                                                                Header="Z диаметр, px"
                                                                Binding="{Binding ZDiameterInPixels}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время добавления"
                                                                        Binding="{Binding AddedDate}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время создания"
                                                                Binding="{Binding CreationDateTime}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Тип">
                                                        <DataGridTextColumn.Binding>
                                                            <Binding Converter="{StaticResource EnumDescription}" Path="PhotoType"/>
                                                        </DataGridTextColumn.Binding>
                                                    </DataGridTextColumn>
                                                    <DataGridTemplateColumn Width="30" x:Name="EditRegularPhotoColumn"
                                                                IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate  DataType="models:DropPhoto">
                                                                <Button 
                                                                    Name="EditInputPhotoButton"
                                                                    IsEnabled="{Binding Editable}"
                                                                    HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                    Width="27" Background="{x:Null}"
                                                                    BorderBrush="{x:Null}" Height="25"
                                                                    Click="EditInputPhotoButton_Click">
                                                                    <ContentControl Content="{StaticResource EditIcon}"
                                                                        Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="30" x:Name="DeleteRegularPhotoColumn"
                                                                    IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate DataType="models:DropPhoto">
                                                                <Button Name="DeleteSingleInputPhotoButton"
                                                                                IsEnabled="{Binding Editable}"
                                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                                Width="27" Background="{x:Null}"
                                                                                BorderBrush="{x:Null}" Height="25"
                                                                                Click="DeleteSingleInputPhotoButton_Click">
                                                                    <ContentControl Content="{StaticResource DeleteIcon}" Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="45" Header="Статус" IsReadOnly="True"
                                                                    CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate DataType="models:DropPhoto">
                                                                <Grid>
                                                                    <TextBlock x:Name="PhotosStatusToolTip"
                                                                                   ToolTip="Радиусы всех капель должны быть расчитаны, чтобы построить график."
                                                                                   Height="25" Width="25" />
                                                                    <ContentControl x:Name="PhotosStatus"
                                                                                    ToolTip="Радиусы всех капель должны быть расчитаны, чтобы построить график."
                                                                                    Content="{StaticResource Warning}"
                                                                                    Height="25" Width="25"
                                                                                    HorizontalAlignment="Center" />
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Processed}" Value="true">
                                                                        <Setter Property="Content"
                                                                                        Value="{StaticResource Ok}"
                                                                                        TargetName="PhotosStatus" />
                                                                        <Setter Property="ToolTip"
                                                                                        Value="Радиус капли расчитан успешно."
                                                                                        TargetName="PhotosStatusToolTip" />
                                                                        <Setter Property="ToolTip"
                                                                                        Value="Радиус капли расчитан успешно."
                                                                                        TargetName="PhotosStatus" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Editable}" Value="false">
                                                                        <Setter Property="Content"
                                                                                Value="{StaticResource Help}"
                                                                                TargetName="PhotosStatus" />
                                                                        <Setter Property="ToolTip"
                                                                                Value="Добавьте снимок, чтобы начать расчет."
                                                                                TargetName="PhotosStatusToolTip" />
                                                                        <Setter Property="ToolTip"
                                                                                Value="Добавьте снимок, чтобы начать расчет."
                                                                                TargetName="PhotosStatus" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Grid>
                                                                    <Button
                                                                        Background="Transparent"
                                                                        IsEnabled="{Binding Editable}"
                                                                        x:Name="DropPhotoCommentToolTip"
                                                                        ToolTip="Добавить комментарий."
                                                                        Height="25" Width="25"
                                                                        Click="DropPhotoCommentToolTip_OnClick">
                                                                        <ContentControl x:Name="DropPhotoComment"
                                                                           ToolTip="Добавить комментарий."
                                                                           Content="{StaticResource AddComment}" Height="25"
                                                                           Width="25" HorizontalAlignment="Center" />
                                                                    </Button>
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                                        <Setter Property="Content" Value="{StaticResource CommentAdded}"
                                                                            TargetName="DropPhotoComment" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="DropPhotoCommentToolTip" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="DropPhotoComment" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                            <GridSplitter
                                                IsEnabled="False"
                                                x:Name="MeasurementsThermalPhotosSplitter"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Center"
                                                Grid.Row="2" Grid.Column="0" ResizeBehavior="PreviousAndNext"
                                                Height="5" Margin="0,95,0,0" />
                                            <DataGrid
                                                IsEnabled="{Binding CurrentSeries.Settings.GeneralSeriesSettings.UseThermalPlot, ElementName=AppMainWindow,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, Converter={StaticResource InverseBooleanConverter}}"
                                                dataGrid:SingleSelectionGroup.GroupName="A"
                                                Grid.Row="3"
                                                Name="ThermalDetails"
                                                Margin="10,5,10,2" 
                                                HorizontalAlignment="Stretch" 
                                                SelectionMode="Single" IsReadOnly="False"
                                                CellEditEnding="ThermalDetails_OnCellEditEnding"
                                                CanUserSortColumns="False"
                                                CanUserAddRows="false" AutoGenerateColumns="false"
                                                ItemsSource="{Binding CurrentThermalPhotos, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True}"
                                                SelectionChanged="ThermalDetails_OnSelectionChanged" RenderTransformOrigin="0.5,0.5">
                                                <DataGrid.RowStyle>
                                                    <Style TargetType="DataGridRow">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter Property="Background"
                                                                        Value="#dde0eb" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGrid.RowStyle>
                                                <DataGrid.Columns>
                                                    <DataGridTemplateColumn Width="30" x:Name="AddThermalPhotoColumn"
                                                                                        IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Name="AddThermalPhoto"
                                                                                    HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                                    Width="27" Background="{x:Null}"
                                                                                    BorderBrush="{x:Null}" Height="25"
                                                                                    Click="AddDropPhoto_OnClick">
                                                                    <ContentControl Content="{StaticResource AddIcon}"
                                                                                                Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTextColumn IsReadOnly="False" Header="Снимок"
                                                                                    Binding="{Binding Name}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время добавления"
                                                                        Binding="{Binding AddedDate}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Время создания"
                                                                Binding="{Binding CreationDateTime}" />
                                                    <DataGridTextColumn IsReadOnly="True" Header="Тип">
                                                        <DataGridTextColumn.Binding>
                                                            <Binding Converter="{StaticResource EnumDescription}" Path="PhotoType"/>
                                                        </DataGridTextColumn.Binding>
                                                    </DataGridTextColumn>
                                                    <DataGridTemplateColumn Width="30" x:Name="EditThermalPhotoColumn"
                                                                            IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate  DataType="models:ThermalPhoto">
                                                                <Button Name="EditThermalPhotoButton"
                                                                        IsEnabled="{Binding Editable}"
                                                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                        Width="27" Background="{x:Null}"
                                                                        BorderBrush="{x:Null}" Height="25"
                                                                        Click="EditThermalPhotoButton_OnClick">
                                                                    <ContentControl Content="{StaticResource EditIcon}"
                                                                                    Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="30" x:Name="DeleteThermalPhotoColumn"
                                                                            IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate DataType="models:DropPhoto">
                                                                <Button Name="DeleteThermalPhoto"
                                                                                IsEnabled="{Binding Editable}"
                                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                                Width="27" Background="{x:Null}"
                                                                                BorderBrush="{x:Null}" Height="25"
                                                                                Click="DeleteThermalPhoto_OnClick">
                                                                    <ContentControl Content="{StaticResource DeleteIcon}" Height="20" />
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="45" Header="Статус" IsReadOnly="True"
                                                                    CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate DataType="models:ThermalPhoto">
                                                                <Grid>
                                                                    <TextBlock x:Name="PhotosStatusToolTip"
                                                                                   ToolTip="Выберите температуру, чтобы построить график."
                                                                                   Height="25" Width="25" />
                                                                    <ContentControl x:Name="PhotosStatus"
                                                                                    ToolTip="Выберите температуру, чтобы построить график."
                                                                                    Content="{StaticResource Warning}"
                                                                                    Height="25" Width="25"
                                                                                    HorizontalAlignment="Center" />
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Processed}" Value="true">
                                                                        <Setter Property="Content"
                                                                                        Value="{StaticResource Ok}"
                                                                                        TargetName="PhotosStatus" />
                                                                        <Setter Property="ToolTip"
                                                                                        Value="Температура выбрана."
                                                                                        TargetName="PhotosStatusToolTip" />
                                                                        <Setter Property="ToolTip"
                                                                                        Value="Температура выбрана."
                                                                                        TargetName="PhotosStatus" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Editable}" Value="false">
                                                                        <Setter Property="Content"
                                                                                Value="{StaticResource Help}"
                                                                                TargetName="PhotosStatus" />
                                                                        <Setter Property="ToolTip"
                                                                                Value="Добавьте снимок, чтобы начать расчет."
                                                                                TargetName="PhotosStatusToolTip" />
                                                                        <Setter Property="ToolTip"
                                                                                Value="Добавьте снимок, чтобы начать расчет."
                                                                                TargetName="PhotosStatus" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Grid>
                                                                    <Button
                                                                        Background="Transparent"
                                                                        x:Name="ThermalPhotoCommentToolTip"
                                                                        ToolTip="Добавить комментарий."
                                                                        Height="25" Width="25"
                                                                        Click="ThermalPhotoCommentToolTip_OnClick"
                                                                        IsEnabled="{Binding Editable}">
                                                                        <ContentControl x:Name="ThermalPhotoComment"
                                                                           ToolTip="Добавить комментарий."
                                                                           Content="{StaticResource AddComment}" Height="25"
                                                                           Width="25" HorizontalAlignment="Center" />
                                                                    </Button>
                                                                </Grid>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                                        <Setter Property="Content" Value="{StaticResource CommentAdded}"
                                                                            TargetName="ThermalPhotoComment" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="ThermalPhotoCommentToolTip" />
                                                                        <Setter Property="ToolTip" Value="{Binding Comment.Content}"
                                                                            TargetName="ThermalPhotoComment" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </Grid>
                                    </loadingSpinner:AdornedControl>
                                </Grid>
                                <GridSplitter
                                    IsEnabled="True"
                                    x:Name="PhotosPreviewGridSplitter"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Center"
                                    Grid.Row="1" Grid.Column="0" ResizeBehavior="PreviousAndNext"
                                    Height="5" />
                                <loadingSpinner:AdornedControl Grid.Column="0" Grid.Row="2"
                                                               Name="CurrentSeriesImageLoading">
                                    <loadingSpinner:AdornedControl.AdornerContent>
                                        <simpleSample:LoadingWait />
                                    </loadingSpinner:AdornedControl.AdornerContent>
                                    <zoomborder:ZoomBorder HorizontalAlignment="Stretch" x:Name="CgsImageViewer"
                                                           ClipToBounds="True" Background="Gray" Margin="10,10,13,10">
                                        <pixelDrawer:PixelDrawer 
                                            DrawningIsEnabled="False"
                                            ImageSource="{Binding ImageForEdit, ElementName=AppMainWindow}"
                                            DrawningMode="{Binding DrawningMode, ElementName=AppMainWindow}"
                                            DrawnShapes="{Binding DrawnShapes, ElementName=AppMainWindow, Mode=TwoWay}"
                                            MouseUp="PixelDrawer_OnMouseUp"
                                            x:Name="ImgCurrent"/>
                                    </zoomborder:ZoomBorder>
                                </loadingSpinner:AdornedControl>
                                <GridSplitter
                                    x:Name="AutoCalculationGridSplitter"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Grid.RowSpan="3" ResizeBehavior="PreviousAndNext"
                                    Width="5"
                                    IsEnabled="False" />
                                <Grid x:Name="ToolBox" Grid.Column="2" Grid.Row="0" Grid.RowSpan="3">
                                    <TabControl MinWidth="200">
                                        <TabItem Header="Общие">
                                            <Grid>
                                                <Label Content="Обработчик" HorizontalAlignment="Left"
                                                       Margin="10,10,0,0" Height="26" VerticalAlignment="Top"
                                                       FontWeight="Bold" />
                                                <ComboBox
                                                    SelectedIndex="{Binding Source={x:Static properties:Settings.Default}, Path=AutoCalculationType}"
                                                    Margin="15,41,10,0" Height="30" VerticalAlignment="Top"
                                                    DropDownClosed="ComboBox_OnDropDownClosed">
                                                    <ComboBoxItem Height="26">
                                                        <Grid Width="160">
                                                            <ContentControl Content="{StaticResource Csharp}"
                                                                            Height="20" />
                                                            <TextBlock Margin="30,3,0,0">Внутренний расчет</TextBlock>
                                                        </Grid>
                                                    </ComboBoxItem>
                                                    <ComboBoxItem Height="26">
                                                        <Grid Width="160">
                                                            <ContentControl Content="{StaticResource Python}" />
                                                            <TextBlock Margin="30,3,0,0">Сторонний скрипт</TextBlock>
                                                        </Grid>
                                                    </ComboBoxItem>
                                                </ComboBox>
                                                <Label Content="Настройки" HorizontalAlignment="Left"
                                                       Margin="10,76,0,0" Height="26" VerticalAlignment="Top"
                                                       FontWeight="Bold" />
                                                <CheckBox
                                                    x:Name="UseRoiCheckbox"
                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseRoi, Mode=TwoWay}"
                                                    Content="Использовать выделенную область" HorizontalAlignment="Left"
                                                    Margin="15,107,0,0" Height="26" VerticalAlignment="Top"
                                                    FontWeight="Normal" 
                                                    Click="UseRoiCheckbox_OnClick"
                                                />
                                                <CheckBox
                                                    x:Name="FrontRoiCheckbox"
                                                    IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseFrontRoiIsEnabled, Mode=TwoWay}"
                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseFrontRoi, Mode=TwoWay}"
                                                    Content="Фото спереди"
                                                    Margin="35,138,0,0" 
                                                    Height="26" 
                                                    VerticalAlignment="Top"
                                                    FontWeight="Normal" 
                                                    HorizontalAlignment="Left" 
                                                    Width="149"
                                                    Click="FrontRoiCheckbox_OnClick"
                                                />
                                                <CheckBox
                                                    x:Name="SideRoiCheckbox"
                                                    IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseSideRoiIsEnabled, Mode=TwoWay}"
                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseSideRoi, Mode=TwoWay}"
                                                    Content="Фото сбоку"
                                                    Margin="35,169,0,0" 
                                                    Height="26" 
                                                    VerticalAlignment="Top"
                                                    FontWeight="Normal" 
                                                    HorizontalAlignment="Left" 
                                                    Width="149"
                                                    Click="SideRoiCheckbox_OnClick"
                                                />
                                                <CheckBox
                                                    x:Name="ThermalRoiCheckbox"
                                                    IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseThermalRoiIsEnabled, Mode=TwoWay}"
                                                    IsChecked="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseThermalRoi, Mode=TwoWay}"
                                                    Content="Термический снимок"
                                                    Margin="35,200,0,0" 
                                                    Height="26" 
                                                    VerticalAlignment="Top"
                                                    FontWeight="Normal" 
                                                    HorizontalAlignment="Left" 
                                                    Width="149" 
                                                    Click="ThermalRoiCheckbox_OnClick"
                                                />
                                                <Button Name="DeleteFrontRoiButton"
                                                        IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseFrontRoiIsEnabled, Mode=TwoWay}"
                                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                                        Width="27" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="DeleteFrontRoiButton_OnClick" Margin="175,132,0,0">
                                                    <ContentControl Content="{StaticResource DeleteIcon}"
                                                                    Height="20" />
                                                </Button>
                                                <Button Name="DeleteSideRoiButton"
                                                        IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseSideRoiIsEnabled, Mode=TwoWay}"
                                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                                        Width="27" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="DeleteSideRoiButton_OnClick" Margin="175,162,0,0">
                                                    <ContentControl Content="{StaticResource DeleteIcon}"
                                                                    Height="20" />
                                                </Button>
                                                <Button Name="DeleteThermalRoiButton"
                                                        IsEnabled="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.UseThermalRoiIsEnabled, Mode=TwoWay}"
                                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                                        Width="27" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="DeleteThermalRoiButton_OnClick" Margin="175,192,0,0">
                                                    <ContentControl Content="{StaticResource DeleteIcon}"
                                                                    Height="20" />
                                                </Button>
                                                <Label Content="Выбрать (необработанных):" HorizontalAlignment="Left"
                                                       Margin="10,221,0,0" Height="26" VerticalAlignment="Top"/>
                                                <TextBox IsEnabled="True" x:Name="SelectNotProcessed"
                                                         Height="20" Margin="0,225,10,0" TextWrapping="Wrap"
                                                         VerticalAlignment="Top" HorizontalAlignment="Right" Width="105" 
                                                         PreviewTextInput="NumberValidationTextBox"
                                                         TextChanged="SelectNotProcessed_OnTextChanged"/>
                                                <Grid Margin="0, 250">
                                                    <Label Content="Настройки тепловизора" HorizontalAlignment="Left"
                                                           Margin="10,231,0,0" Height="26" VerticalAlignment="Top"
                                                           FontWeight="Bold" />
                                                    <Label Content="Найти:" HorizontalAlignment="Left"
                                                           Margin="10,262,0,0" Height="26" VerticalAlignment="Top"
                                                           FontWeight="Normal" />
                                                    <ComboBox
                                                        SelectedValue="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.TemperatureDetectingMode, Mode=TwoWay}"
                                                        ItemsSource="{Binding Source={markUp:Enumeration {x:Type enums:TemperatureDetectingMode}}}"
                                                        SelectedValuePath="Value"
                                                        DisplayMemberPath="Description"
                                                        x:Name="TemperatureDetectionModeCombobox"
                                                        DropDownClosed="TemperatureDetectionModeCombobox_OnDropDownClosed"
                                                        Margin="61,263,10,0" Height="25" VerticalAlignment="Top"
                                                    />
                                                    <Label Content="В:" HorizontalAlignment="Left"
                                                           Margin="10,293,0,0" Height="26" VerticalAlignment="Top"
                                                           FontWeight="Normal" />
                                                    <ComboBox
                                                        SelectedValue="{Binding ElementName=AppMainWindow, Path=CurrentSeries.Settings.AutoCalculationSettings.ThermalAutoCalculationSettings, Mode=TwoWay}"
                                                        ItemsSource="{Binding Source={markUp:Enumeration {x:Type enums:ThermalAutoCalculationSettings}}}"
                                                        SelectedValuePath="Value"
                                                        DisplayMemberPath="Description"
                                                        x:Name="AutoCalcSearchModeCombobox"
                                                        DropDownClosed="AutoCalcSearchModeCombobox_OnDropDownClosed"
                                                        Margin="61,293,10,0" Height="25" VerticalAlignment="Top"
                                                    />
                                                </Grid>
                                            </Grid>
                                        </TabItem>
                                        <TabItem Header="C# расчет">
                                            <Grid>
                                                <Label Content="Параметры" HorizontalAlignment="Left"
                                                       Margin="10,10,0,0" Height="26" VerticalAlignment="Top"
                                                       FontWeight="Bold" />
                                                <Label Content="Размытие:" HorizontalAlignment="Left"
                                                       Margin="10,41,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="CShrpKsize" Increment="2"
                                                                          AllowTextInput="False" Minimum="1"
                                                                          Margin="113,44,10,0"
                                                                          Text="{Binding ElementName=AppMainWindow, Path=СurrentCSharpAutoCalculationTemplate.Parameters.Ksize}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Порог (мин):" HorizontalAlignment="Left"
                                                       Margin="10,72,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="CShrpThreshold1" Margin="113,75,10,0"
                                                                          Text="{Binding ElementName=AppMainWindow, Path=СurrentCSharpAutoCalculationTemplate.Parameters.Treshold1}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Порог (макс):" HorizontalAlignment="Left"
                                                       Margin="10,103,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="CShrpThreshold2"
                                                                          Margin="113,106,10,0"
                                                                          Text="{Binding ElementName=AppMainWindow, Path=СurrentCSharpAutoCalculationTemplate.Parameters.Treshold2}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Высота контура:" HorizontalAlignment="Left"
                                                       Margin="10,134,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="CShrpSize1" Margin="113,137,10,0"
                                                                          Text="{Binding ElementName=AppMainWindow, Path=СurrentCSharpAutoCalculationTemplate.Parameters.Size1}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Ширина контура:" HorizontalAlignment="Left"
                                                       Margin="10,165,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="CShrpSize2" Margin="113,168,10,0"
                                                                          Text="{Binding ElementName=AppMainWindow, Path=СurrentCSharpAutoCalculationTemplate.Parameters.Size2}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label x:Name="ChooseCSharpTemplate" Content="Выбрать шаблон:"
                                                       HorizontalAlignment="Left" Margin="10,196,0,0" Height="26"
                                                       VerticalAlignment="Top" />
                                                <Label x:Name="CSharpTemplateName" Visibility="Hidden"
                                                       Content="Название:" HorizontalAlignment="Left"
                                                       Margin="10,196,0,0" Height="26" VerticalAlignment="Top" />
                                                <ComboBox x:Name="CSharpTemplatesCombobox" Margin="113,199,37,0"
                                                          Height="23" VerticalAlignment="Top"
                                                          ItemsSource="{Binding ElementName=AppMainWindow, Path=CSharpAutoCalculationTemplate}"
                                                          DisplayMemberPath="Title"
                                                          DropDownClosed="CSharpTemplatesCombobox_OnDropDownClosed" />
                                                <TextBox Visibility="Hidden" x:Name="TextBoxCSharpTemplateName"
                                                         Margin="113,199,70,0" Height="23" VerticalAlignment="Top" />
                                                <Button Visibility="Visible" Grid.Row="0" Name="AddCSharpTemplate"
                                                        VerticalAlignment="Top" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="AddCSharpTemplate_OnClick" ToolTip="Добавить шаблон."
                                                        Margin="0,197,12,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource AddIcon}" Height="21" />
                                                </Button>
                                                <Button Visibility="Hidden" Grid.Row="0" Name="SaveCSharpTemplate"
                                                        VerticalAlignment="Top" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="SaveCSharpTemplate_OnClick" ToolTip="Сохранить шаблон."
                                                        Margin="0,197,42,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource SaveIcon}" Height="21" />
                                                </Button>
                                                <Button Visibility="Hidden" Grid.Row="0"
                                                        Name="CancelCSharpTemplateAdding" VerticalAlignment="Top"
                                                        Background="{x:Null}" BorderBrush="{x:Null}" Height="25"
                                                        Click="CancelCSharpTemplateAdding_OnClick" ToolTip="Отмена."
                                                        Margin="0,197,10,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource Cancel}" Height="21" />
                                                </Button>
                                            </Grid>
                                        </TabItem>
                                        <TabItem Header="Python расчет">
                                            <Grid>
                                                <Label Content="Интерпритатор:" HorizontalAlignment="Left"
                                                       Margin="10,0,0,41" Height="26" VerticalAlignment="Bottom" />
                                                <TextBox Name="InterpreterTextBox" Margin="113,0,62,38"
                                                         TextWrapping="Wrap" IsEnabled="False" Height="23"
                                                         VerticalAlignment="Bottom" />
                                                <Button Name="Interpreter" Click="ChooseFilePath_OnClick"
                                                        HorizontalAlignment="Right" Margin="0,0,10,38"
                                                        VerticalAlignment="Bottom" Width="47" Height="23"
                                                        Background="{x:Null}" BorderBrush="{x:Null}"
                                                        ToolTip="Выбрать python интерпритатор.">
                                                    <Rectangle Fill="#34558b" RenderTransformOrigin="0.704,0.315"
                                                               Height="19" Width="19">
                                                        <Rectangle.OpacityMask>
                                                            <VisualBrush Stretch="Fill"
                                                                         Visual="{StaticResource EditIcon}" />
                                                        </Rectangle.OpacityMask>
                                                    </Rectangle>
                                                </Button>
                                                <Label Content="Скрипт:" HorizontalAlignment="Left" Margin="10,0,0,10"
                                                       Height="26" VerticalAlignment="Bottom" />
                                                <TextBox Name="ScriptToRunTextBox" Margin="113,0,62,10"
                                                         TextWrapping="Wrap" IsEnabled="False" Height="23"
                                                         VerticalAlignment="Bottom" />
                                                <Button Name="ScriptToRun" Click="ChooseFilePath_OnClick"
                                                        Margin="0,0,10,10" VerticalAlignment="Bottom" Height="23"
                                                        HorizontalAlignment="Right" Width="47" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" ToolTip="Выбрать скрипт для запуска.">
                                                    <Rectangle Fill="#34558b" RenderTransformOrigin="0.704,0.315"
                                                               Height="19" Width="19">
                                                        <Rectangle.OpacityMask>
                                                            <VisualBrush Stretch="Fill"
                                                                         Visual="{StaticResource EditIcon}" />
                                                        </Rectangle.OpacityMask>
                                                    </Rectangle>
                                                </Button>
                                                <Label Content="Параметры" HorizontalAlignment="Left"
                                                       Margin="10,10,0,0" Height="26" VerticalAlignment="Top"
                                                       FontWeight="Bold" />
                                                <Label Content="Размытие:" HorizontalAlignment="Left"
                                                       Margin="10,41,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown Increment="2" AllowTextInput="False"
                                                                          Minimum="1" x:Name="Ksize"
                                                                          Margin="113,44,10,0"
                                                                          Value="{Binding ElementName=AppMainWindow, Path=СurrentPythonAutoCalculationTemplate.Parameters.Ksize}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Порог (мин):" HorizontalAlignment="Left"
                                                       Margin="10,72,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="Threshold1" Margin="113,75,10,0"
                                                                          Minimum="1"
                                                                          Value="{Binding ElementName=AppMainWindow, Path=СurrentPythonAutoCalculationTemplate.Parameters.Treshold1}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Порог (макс):" HorizontalAlignment="Left"
                                                       Margin="10,103,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="Threshold2" Margin="113,106,10,0"
                                                                          Minimum="1"
                                                                          Value="{Binding ElementName=AppMainWindow, Path=СurrentPythonAutoCalculationTemplate.Parameters.Treshold2}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Высота контура:" HorizontalAlignment="Left"
                                                       Margin="10,134,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="Size1" Margin="113,137,10,0"
                                                                          Minimum="1"
                                                                          Value="{Binding ElementName=AppMainWindow, Path=СurrentPythonAutoCalculationTemplate.Parameters.Size1}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label Content="Ширина контура:" HorizontalAlignment="Left"
                                                       Margin="10,165,0,0" Height="26" VerticalAlignment="Top" />
                                                <extToolkit:IntegerUpDown x:Name="Size2" Margin="113,168,10,0"
                                                                          Minimum="1"
                                                                          Value="{Binding ElementName=AppMainWindow, Path=СurrentPythonAutoCalculationTemplate.Parameters.Size2}"
                                                                          Height="23" VerticalAlignment="Top" />
                                                <Label x:Name="ChoosePythonTemplate" Content="Выбрать шаблон:"
                                                       HorizontalAlignment="Left" Margin="10,196,0,0" Height="26"
                                                       VerticalAlignment="Top" />
                                                <Label x:Name="PythonTemplateName" Visibility="Hidden"
                                                       Content="Название:" HorizontalAlignment="Left"
                                                       Margin="10,196,0,0" Height="26" VerticalAlignment="Top" />
                                                <ComboBox x:Name="PythonTemplatesCombobox" Margin="113,199,37,0"
                                                          Height="23" VerticalAlignment="Top"
                                                          ItemsSource="{Binding ElementName=AppMainWindow, Path=PythonAutoCalculationTemplate}"
                                                          DisplayMemberPath="Title"
                                                          DropDownClosed="PythonTemplatesCombobox_OnDropDownClosed" />
                                                <TextBox Visibility="Hidden" x:Name="TextBoxPythonTemplateName"
                                                         Margin="113,199,70,0" Height="23" VerticalAlignment="Top" />
                                                <Button Visibility="Visible" Grid.Row="0" Name="AddPythonTemplate"
                                                        VerticalAlignment="Top" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="AddPythonTemplate_OnClick" ToolTip="Добавить шаблон."
                                                        Margin="0,197,12,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource AddIcon}" Height="21" />
                                                </Button>
                                                <Button Visibility="Hidden" Grid.Row="0" Name="SavePythonTemplate"
                                                        VerticalAlignment="Top" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        Click="SavePythonTemplate_OnClick" ToolTip="Сохранить шаблон."
                                                        Margin="0,197,42,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource SaveIcon}" Height="21" />
                                                </Button>
                                                <Button Visibility="Hidden" Grid.Row="0"
                                                        Name="CancelPythonTemplateAdding" VerticalAlignment="Top"
                                                        Background="{x:Null}" BorderBrush="{x:Null}" Height="25"
                                                        Click="CancelPythonTemplateAdding_OnClick" ToolTip="Отмена."
                                                        Margin="0,197,10,0" HorizontalAlignment="Right" Width="27">
                                                    <ContentControl Content="{StaticResource Cancel}" Height="21" />
                                                </Button>
                                            </Grid>
                                        </TabItem>
                                    </TabControl>
                                </Grid>
                            </Grid>
                        </TabItem>
                        <TabItem x:Name="ReferenceTab" Header="Референс">
                            <Grid Background="#FFE5E5E5">
                                <Border Background="Gainsboro" BorderThickness="1" Height="42" Margin="10,10,10,0" VerticalAlignment="Top">
                                    <Grid>
                                        <Button Click="SaveReferenceLine_Click" Visibility="Hidden" Name="SaveReferenceLine"
                                                Margin="10,9,0,0" VerticalAlignment="Top" Height="23" Background="{x:Null}"
                                                BorderBrush="{x:Null}" HorizontalAlignment="Left" Width="25"
                                                ToolTip="Сохранить референсное расстояние.">
                                            <Rectangle Fill="#34558b" RenderTransformOrigin="0.704,0.315" Height="19"
                                                       Width="19">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{StaticResource SaveIcon}" />
                                                </Rectangle.OpacityMask>
                                            </Rectangle>
                                        </Button>
                                        <Button Name="CancelReferencePhotoEditing" Visibility="Hidden"
                                                HorizontalAlignment="Left" Margin="46,7,0,0" VerticalAlignment="Top"
                                                Width="27" Background="{x:Null}" BorderBrush="{x:Null}" Height="27"
                                                Click="CancelReferencePhotoEditing_OnClick"
                                                ToolTip="Отменить изменения референсного расстояния.">
                                            <ContentControl Content="{StaticResource Cancel}" Height="23" Width="23" />
                                        </Button>
                                    </Grid>
                                </Border>
                                <Grid x:Name="ReferenceGrid" Background="#FFE5E5E5" Margin="0,52,0,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="105" />
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"  x:Name="ReferencePreviewRow"/>
                                    </Grid.RowDefinitions>
                                    <DataGrid 
                                        x:Name="ReferencePhotoDataGrid" 
                                        Margin="10" 
                                        SelectionChanged="ReferencePhotoDataGrid_OnSelectionChanged" 
                                        ItemsSource="{Binding CurrentReferencePhotos, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}"
                                        AutoGenerateColumns="false"
                                        CanUserSortColumns="False"
                                        CanUserReorderColumns="False"
                                        CanUserAddRows="False"
                                        SelectionMode="Single"
                                        IsReadOnly="False"
                                        Grid.Row="0"
                                        RowHeight="28"
                                    >
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="30" x:Name="ChooseReferenceButton"
                                                                IsReadOnly="True" CanUserResize="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Name="AddReferencePhoto"
                                                            HorizontalAlignment="Left" VerticalAlignment="Top"
                                                            Width="27" Background="{x:Null}"
                                                            BorderBrush="{x:Null}" Height="25"
                                                            Click="ChooseReference_OnClick">
                                                            <ContentControl Content="{StaticResource AddIcon}"
                                                                        Height="20" />
                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Header="Название" Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                                            <DataGridTextColumn IsReadOnly="True" Header="Пикселей в миллиметре" Binding="{Binding PixelsInMillimeter, UpdateSourceTrigger=PropertyChanged}"/>
                                            <DataGridTextColumn IsReadOnly="True" Header="Тип">
                                                <DataGridTextColumn.Binding>
                                                    <Binding Converter="{StaticResource EnumDescription}" Path="PhotoType"/>
                                                </DataGridTextColumn.Binding>
                                            </DataGridTextColumn>
                                            <DataGridTemplateColumn Width="30" x:Name="ChangeReferenceLine"
                                                                IsReadOnly="True" CanUserResize="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate  DataType="models:ReferencePhoto">
                                                        <Button 
                                                        Name="EditReferencePhotoButton"
                                                        HorizontalAlignment="Left" VerticalAlignment="Top"
                                                        Width="27" Background="{x:Null}"
                                                        BorderBrush="{x:Null}" Height="25"
                                                        IsEnabled="{Binding Editable}"
                                                        Click="ChangeReferenceLine_Click">
                                                            <ContentControl Content="{StaticResource EditIcon}"
                                                                        Height="20" />
                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTemplateColumn Width="30" x:Name="DeleteButton"
                                                                    IsReadOnly="True" CanUserResize="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate DataType="models:ReferencePhoto">
                                                        <Button Name="DeleteReferencePhotoButton"
                                                            HorizontalAlignment="Left" VerticalAlignment="Top"
                                                            Width="27" Background="{x:Null}"
                                                            BorderBrush="{x:Null}" Height="25"
                                                            IsEnabled="{Binding Editable}"
                                                            Click="DeleteReferencePhotoButton_Click">
                                                            <ContentControl Content="{StaticResource DeleteIcon}" Height="20" />
                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <GridSplitter
                                    IsEnabled="True"
                                    x:Name="ReferenceGridSplitter"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Center"
                                    Grid.Row="1" Grid.Column="0" ResizeBehavior="PreviousAndNext"
                                    Height="5" />
                                    <Grid Grid.Row="2">
                                        <Border Name="Border" BorderThickness="1" BorderBrush="#34558b"
                                            Margin="10">
                                            <loadingSpinner:AdornedControl Name="ReferenceImageLoading" Margin="0,-1,0,0">
                                                <loadingSpinner:AdornedControl.AdornerContent>
                                                    <simpleSample:LoadingWait />
                                                </loadingSpinner:AdornedControl.AdornerContent>
                                                <zoomborder:ZoomBorder x:Name="ReferenceBorder" ClipToBounds="True"
                                                                   Background="Gray">
                                                    <pixelDrawer:PixelDrawer IsEnabled="False"
                                                                         DrawningMode="{Binding DrawningMode, ElementName=AppMainWindow}"
                                                                         DrawnShapes="{Binding DrawnShapes, ElementName=AppMainWindow, Mode=TwoWay}"
                                                                         MouseUp="PixelDrawer_OnMouseUp"
                                                                         ImageSource="{Binding ReferenceImage, ElementName=AppMainWindow}"
                                                                         x:Name="MainWindowPixelDrawer" />
                                                </zoomborder:ZoomBorder>
                                            </loadingSpinner:AdornedControl>
                                        </Border>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            <TabItem Name="CombinedSeriesPlot" Header="Графики">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="0" MaxWidth="300" x:Name="CustomPlotsColumn" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="0" x:Name="CustomPlotsRow" />
                    </Grid.RowDefinitions>
                    <Border x:Name="PlotManagerMenuBar" Grid.Column="0" Grid.Row="0" Background="Gainsboro"
                            BorderThickness="1" Height="41" Margin="10,10,10,0" VerticalAlignment="Top">
                        <Grid>
                            <Button Grid.Row="0" Grid.Column="0" Name="EditPlots"
                                    HorizontalAlignment="Left" Margin="10,6,0,0"
                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                    BorderBrush="{x:Null}" Height="27" Click="EditPlots_OnClick"
                                    ToolTip="Редактировать пользовательские графики.">
                                <ContentControl Content="{StaticResource EditTable}" Height="21" />
                            </Button>
                            <Button Grid.Row="0" Grid.Column="0" Name="StopEditPlots"
                                    HorizontalAlignment="Left" Margin="10,7,0,0"
                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                    BorderBrush="{x:Null}" Height="26"
                                    Click="StopEditPlots_OnClick"
                                    ToolTip="Закончить редактирование пользовательских графиков" Visibility="Hidden">
                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                Width="23" />
                            </Button>

                            <Button Visibility="Hidden" Grid.Row="0" Grid.Column="0"
                                    Name="SavePlot"
                                    Margin="10,6,0,7"
                                    Background="{x:Null}" BorderBrush="{x:Null}"
                                    Click="SavePlot_OnClick"
                                    ToolTip="Сохранить график." HorizontalAlignment="Left" Width="27">
                                <ContentControl Content="{StaticResource SaveIcon}" Height="21"
                                                Width="23" />
                            </Button>
                            <Button Visibility="Hidden" Grid.Row="0" Grid.Column="0"
                                    Name="ImportPlot"
                                    Margin="42,6,0,7"
                                    Background="{x:Null}" BorderBrush="{x:Null}"
                                    Click="ImportPlot_OnClick"
                                    ToolTip="Импортировать график." HorizontalAlignment="Left" Width="27">
                                <ContentControl Content="{StaticResource ImportLocalSeries}" Height="21"
                                                Width="23" />
                            </Button>
                            <Button Grid.Row="0" Grid.Column="0" Name="DiscardPlotEdit"
                                    HorizontalAlignment="Left" Margin="72,7,0,0"
                                    VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                    BorderBrush="{x:Null}" Height="26"
                                    Click="DiscardPlotEdit_OnClick"
                                    ToolTip="Закончить редактирование графика без сохранения" Visibility="Hidden">
                                <ContentControl Content="{StaticResource Cancel}" Height="22"
                                                Width="23" />
                            </Button>
                            <Label x:Name="XDimensionlessDividerLabel" Visibility="Hidden" FontSize="10" Padding="0 2 0 0" Content="Обезразмеривающий коэффициент по X:" Margin="104,10,0,10" HorizontalAlignment="Left" Width="192"/>
                            <TextBox Visibility="Hidden" Grid.Column="0" Grid.Row="0" Name="XDimensionlessDividerTextBox" Height="19"
                                     VerticalAlignment="Top" Margin="301,10,0,0" HorizontalAlignment="Left" Width="65" 
                                     Text="{Binding CurrentPlot.Settings.DimensionlessSettings.XDimensionlessDivider, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged, Delay=1000}"/>

                            <Label x:Name="YDimensionlessDividerLabel" Visibility="Hidden" FontSize="10" Padding="0 2 0 0" Content="Обезразмеривающий коэффициент по Y:" Margin="402,10,0,10" HorizontalAlignment="Left" Width="192"/>
                            <TextBox Visibility="Hidden" Grid.Column="0" Grid.Row="0" Name="YDimensionlessDividerTextBox" Height="19"
                                     VerticalAlignment="Top" Margin="599,10,0,0" HorizontalAlignment="Left" Width="65" 
                                     Text="{Binding CurrentPlot.Settings.DimensionlessSettings.YDimensionlessDivider, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged, Delay=1000 }"/>

                        </Grid>
                    </Border>
                    <scatterPlot:ScatterPlot
                        x:Name="Plot"
                        XAxesCollection="{Binding XAxesCollection, ElementName=AppMainWindow}"
                        YAxesCollection="{Binding YAxesCollection, ElementName=AppMainWindow}"
                        SeriesCollectionToPlot="{Binding SeriesCollectionToPlot, ElementName=AppMainWindow}" 
                        Grid.Column="0" 
                        Grid.Row="0" 
                        Margin="10,56,10,0"
                    />
                    <GridSplitter
                        x:Name="PlotsGridSplitter"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Grid.Row="0"
                        Grid.RowSpan="3"
                        Grid.Column="1"
                        ResizeBehavior="PreviousAndNext"
                        Width="5"
                        IsEnabled="False" />
                    <Grid x:Name="PlotsToolBox" Grid.Column="2" Grid.Row="0" Grid.RowSpan="3">
                        <loadingSpinner:AdornedControl Name="PlotToolboxLoading">
                            <loadingSpinner:AdornedControl.AdornerContent>
                                <simpleSample:LoadingWait />
                            </loadingSpinner:AdornedControl.AdornerContent>
                            <Grid>
                                <Border x:Name="PlotToolBoxMenuBar" Grid.Column="0" Grid.Row="0" Background="Gainsboro"
                                BorderThickness="1" Height="41" Margin="10,10,10,0" VerticalAlignment="Top">
                                    <Grid>
                                        <Button Grid.Row="0" Grid.Column="0" Name="AddPlots"
                                        HorizontalAlignment="Left" Margin="10,6,0,0"
                                        VerticalAlignment="Top" Width="27" Background="{x:Null}"
                                        BorderBrush="{x:Null}" Height="27" Click="AddPlots_OnClick"
                                        ToolTip="Добавить график.">
                                            <ContentControl Content="{StaticResource AddIcon}" Height="21" />
                                        </Button>
                                    </Grid>
                                </Border>
                                <TabControl x:Name="PlotToolBoxTabControl" Margin="10,60,10,0" SelectionChanged="PlotToolBoxTabControl_OnSelectionChanged">
                                    <TabItem x:Name="RadiusTabItem" Header="Радиус">
                                        <DataGrid 
                                            ColumnWidth="*" 
                                            dataGrid:VisualHelper.EnableRowsMove="False"
                                            CellEditEnding="CustomPlots_OnCellEditEnding" CanUserSortColumns="False"
                                            CanUserAddRows="false" AutoGenerateColumns="false"
                                            HorizontalAlignment="Stretch" Name="CustomPlots" Margin="10,10,10,5"
                                            SelectionMode="Single" SelectionChanged="CustomPlots_OnSelectionChanged"
                                            IsReadOnly="False"
                                            ItemsSource="{Binding AvailableRadiusPlots, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}">
                                            <DataGrid.RowStyle>
                                                <Style TargetType="DataGridRow">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#dde0eb" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGrid.RowStyle>
                                            <DataGrid.Columns>
                                                <DataGridCheckBoxColumn 
                                                    Width="25" 
                                                    x:Name="PlotsCheckedColumn"
                                                    IsReadOnly="False"
                                                    Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                                    CanUserResize="False">
                                                    <DataGridCheckBoxColumn.HeaderTemplate>
                                                        <DataTemplate>
                                                            <CheckBox
                                                                IsChecked="{Binding ElementName=AppMainWindow, Path=AllSelectedPlots}"
                                                                x:Name="ChooseAllSeries" Height="15" />
                                                        </DataTemplate>
                                                    </DataGridCheckBoxColumn.HeaderTemplate>
                                                    <DataGridCheckBoxColumn.CellStyle>
                                                        <Style>
                                                            <EventSetter Event="CheckBox.Checked" Handler="OnPlotsChecked"/>
                                                            <EventSetter Event="CheckBox.Unchecked" Handler="OnPlotsUnchecked"/>
                                                        </Style>
                                                    </DataGridCheckBoxColumn.CellStyle>
                                                </DataGridCheckBoxColumn>
                                                <DataGridTextColumn 
                                                        Header="График" 
                                                        Binding="{Binding Name}">
                                                    <DataGridTextColumn.CellStyle>
                                                        <Style>
                                                            <Setter Property="UIElement.IsEnabled" Value="{Binding IsEditable, Converter={StaticResource InverseBooleanConverter}}" />
                                                        </Style>
                                                    </DataGridTextColumn.CellStyle>
                                                </DataGridTextColumn>
                                                <DataGridTemplateColumn Width="30" x:Name="EditPlotColumn" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button 
                                                                Name="EditPlotButton"
                                                                Visibility="{Binding IsEditable, Converter={StaticResource VisibleIfTrue}}"
                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                Width="27" Background="{x:Null}"
                                                                BorderBrush="{x:Null}" Height="25"
                                                                Click="EditPlotButton_OnClick">
                                                                <ContentControl Content="{StaticResource EditIcon}"
                                                                Height="20" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Width="30" x:Name="DeletePlotColumn" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button 
                                                                Name="DeleteSinglePlotButton"
                                                                Visibility="{Binding IsDeletable, Converter={StaticResource VisibleIfTrue}}"
                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                Width="27" Background="{x:Null}"
                                                                BorderBrush="{x:Null}" Height="25"
                                                                Click="DeleteSinglePlotButton_OnClick">
                                                                <ContentControl Content="{StaticResource DeleteIcon}"
                                                                                Height="20" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Grid>
                                                                <Button
                                                                    Background="Transparent"
                                                                    Visibility="{Binding IsEditable, Converter={StaticResource VisibleIfTrue}}"
                                                                    x:Name="MeasurementCommentToolTip"
                                                                    ToolTip="Добавить комментарий."
                                                                    Height="25" Width="25"
                                                                    Click="MeasurementCommentToolTip_OnClick">
                                                                    <ContentControl 
                                                                       x:Name="MeasurementComment"
                                                                       ToolTip="Добавить комментарий."
                                                                       Content="{StaticResource AddComment}" Height="25"
                                                                       Width="25" HorizontalAlignment="Center" />
                                                                </Button>
                                                            </Grid>
                                                            <DataTemplate.Triggers>
                                                                <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                                    <Setter Property="Content" Value="{StaticResource CommentAdded}" TargetName="MeasurementComment" />
                                                                    <Setter Property="ToolTip" Value="{Binding Comment.Content}" TargetName="MeasurementCommentToolTip" />
                                                                    <Setter Property="ToolTip" Value="{Binding Comment.Content}" TargetName="MeasurementComment" />
                                                                </DataTrigger>
                                                            </DataTemplate.Triggers>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </TabItem>
                                    <TabItem x:Name="TemperatureTabItem" Header="Температура">
                                        <DataGrid 
                                            ColumnWidth="*" 
                                            dataGrid:VisualHelper.EnableRowsMove="False"
                                            CellEditEnding="TemperaturePlots_OnCellEditEnding" CanUserSortColumns="False"
                                            CanUserAddRows="false" AutoGenerateColumns="false"
                                            HorizontalAlignment="Stretch" Name="TemperaturePlots" Margin="10,10,10,5"
                                            SelectionMode="Single" SelectionChanged="TemperaturePlots_OnSelectionChanged"
                                            IsReadOnly="False"
                                            ItemsSource="{Binding AvailableTemperaturePlots, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}">
                                            <DataGrid.RowStyle>
                                                <Style TargetType="DataGridRow">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#dde0eb" />
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGrid.RowStyle>
                                            <DataGrid.Columns>
                                                <DataGridCheckBoxColumn 
                                                    Width="25" 
                                                    x:Name="TemperaturePlotsCheckedColumn"
                                                    IsReadOnly="False"
                                                    Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                                    CanUserResize="False">
                                                    <DataGridCheckBoxColumn.HeaderTemplate>
                                                        <DataTemplate>
                                                            <CheckBox
                                                                IsChecked="{Binding ElementName=AppMainWindow, Path=AllSelectedTemperaturePlots}"
                                                                x:Name="ChooseAllSeries" Height="15" 
                                                            />
                                                        </DataTemplate>
                                                    </DataGridCheckBoxColumn.HeaderTemplate>
                                                    <DataGridCheckBoxColumn.CellStyle>
                                                        <Style>
                                                            <EventSetter Event="CheckBox.Checked" Handler="OnTemperaturePlotsChecked"/>
                                                            <EventSetter Event="CheckBox.Unchecked" Handler="OnTemperaturePlotsUnchecked"/>
                                                        </Style>
                                                    </DataGridCheckBoxColumn.CellStyle>
                                                </DataGridCheckBoxColumn>
                                                <DataGridTextColumn 
                                                    Header="График" 
                                                    Binding="{Binding Name}"
                                                >
                                                    <DataGridTextColumn.CellStyle>
                                                        <Style>
                                                            <Setter Property="UIElement.IsEnabled" Value="{Binding IsEdtiable, Converter={StaticResource InverseBooleanConverter}}" />
                                                        </Style>
                                                    </DataGridTextColumn.CellStyle>
                                                </DataGridTextColumn>
                                                <DataGridTemplateColumn Width="30" x:Name="EditTemperaturePlotColumn" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button 
                                                                Name="EditPlotButton"
                                                                Visibility="{Binding IsEditable, Converter={StaticResource VisibleIfTrue}}"
                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                Width="27" Background="{x:Null}"
                                                                BorderBrush="{x:Null}" Height="25"
                                                                Click="EditPlotButton_OnClick">
                                                                <ContentControl Content="{StaticResource EditIcon}"
                                                                Height="20" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Width="30" x:Name="DeleteTemperaturePlotColumn" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button 
                                                                Name="DeleteSingleTemperaturePlotButton"
                                                                Visibility="{Binding IsDeletable, Converter={StaticResource VisibleIfTrue}}"
                                                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                                                Width="27" Background="{x:Null}"
                                                                BorderBrush="{x:Null}" Height="25"
                                                                Click="DeleteSingleTemperaturePlotButton_OnClick">
                                                                <ContentControl Content="{StaticResource DeleteIcon}"
                                                                                Height="20" />
                                                            </Button>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Width="90" Header="Комментарий" IsReadOnly="True" CanUserResize="False">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Grid>
                                                                <Button
                                                                    Background="Transparent"
                                                                    Visibility="{Binding IsEditable, Converter={StaticResource VisibleIfTrue}}"
                                                                    x:Name="MeasurementCommentToolTip"
                                                                    ToolTip="Добавить комментарий."
                                                                    Height="25" Width="25"
                                                                    Click="MeasurementCommentToolTip_OnClick">
                                                                    <ContentControl 
                                                                       x:Name="MeasurementComment"
                                                                       ToolTip="Добавить комментарий."
                                                                       Content="{StaticResource AddComment}" Height="25"
                                                                       Width="25" HorizontalAlignment="Center" />
                                                                </Button>
                                                            </Grid>
                                                            <DataTemplate.Triggers>
                                                                <DataTrigger Binding="{Binding Comment.CommentAdded}" Value="true">
                                                                    <Setter Property="Content" Value="{StaticResource CommentAdded}" TargetName="MeasurementComment" />
                                                                    <Setter Property="ToolTip" Value="{Binding Comment.Content}" TargetName="MeasurementCommentToolTip" />
                                                                    <Setter Property="ToolTip" Value="{Binding Comment.Content}" TargetName="MeasurementComment" />
                                                                </DataTrigger>
                                                            </DataTemplate.Triggers>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </TabItem>
                                </TabControl>
                            </Grid>
                        </loadingSpinner:AdornedControl>
                    </Grid>
                    <GridSplitter HorizontalAlignment="Stretch"
                                  VerticalAlignment="Center"
                                  Grid.Column="0"
                                  IsEnabled="False"
                                  Grid.Row="1" ResizeBehavior="PreviousAndNext"
                                  Height="5" />
                    <DataGrid 
                            Grid.Row="2"
                            Grid.Column="0"
                            ColumnWidth="*" 
                            CanUserAddRows="True" AutoGenerateColumns="false"
                            HorizontalAlignment="Stretch" Name="CustomPlotsDetails" Margin="10,10,10,5"
                            SelectionMode="Extended" SelectionChanged="Photos_SelectionChanged"
                            IsReadOnly="False"
                            ItemsSource="{Binding CurrentPlot.Points, ElementName=AppMainWindow,Mode=TwoWay,NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}">
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#dde0eb" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn IsReadOnly="False" Header="X" Binding="{Binding X}" />
                            <DataGridTextColumn IsReadOnly="False" Header="Y" Binding="{Binding Y}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <Menu x:Name="MainMenuBar" Height="22" Margin="10,10,10,0" VerticalAlignment="Top">
            <Menu.ItemsPanel>
                <ItemsPanelTemplate>
                    <DockPanel HorizontalAlignment="Stretch" />
                </ItemsPanelTemplate>
            </Menu.ItemsPanel>
            <MenuItem Width="50" Height="22" Header="Меню">
                <MenuItem Header="Опции" Click="Options_OnClick">
                    <MenuItem.Icon>
                        <Rectangle Fill="#34558b" Margin="2,1,0,1" RenderTransformOrigin="0.704,0.315">
                            <Rectangle.OpacityMask>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource SettingsIcon}" />
                            </Rectangle.OpacityMask>
                        </Rectangle>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Информация" Click="Information_Click" Name="Information">
                    <MenuItem.Icon>
                        <Rectangle Fill="#34558b" Margin="2,1,0,1" RenderTransformOrigin="0.704,0.315">
                            <Rectangle.OpacityMask>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource Information}" />
                            </Rectangle.OpacityMask>
                        </Rectangle>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Выйти" Click="MenuItem_OnClick" />
            </MenuItem>
            <MenuItem Header="Учетная запись" HorizontalAlignment="Right">
                <MenuItem x:Name="AccountMenuItem" Visibility="Collapsed" Header="Аккаунт"
                          Click="AccountMenuItem_Click">
                    <MenuItem.Icon>
                        <Rectangle Fill="#34558b" Margin="2,1,0,1" RenderTransformOrigin="0.704,0.315">
                            <Rectangle.OpacityMask>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource Account}" />
                            </Rectangle.OpacityMask>
                        </Rectangle>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem x:Name="LogInMenuItem" Header="Войти" Click="LoginMenuItem_Click" Margin="1,0,0,0">
                    <MenuItem.Icon>
                        <Rectangle Fill="#34558b" Margin="2,1,0,1" RenderTransformOrigin="0.704,0.315">
                            <Rectangle.OpacityMask>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource Login}" />
                            </Rectangle.OpacityMask>
                        </Rectangle>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem x:Name="LogOutMenuItem" Visibility="Collapsed" Header="Выйти" Click="LogoutMenuItem_Click"
                          Margin="1,0,0,0">
                    <MenuItem.Icon>
                        <Rectangle Fill="#34558b" Margin="2,1,0,1" RenderTransformOrigin="0.704,0.315">
                            <Rectangle.OpacityMask>
                                <VisualBrush Stretch="Fill" Visual="{StaticResource Logout}" />
                            </Rectangle.OpacityMask>
                        </Rectangle>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>
        <Grid Margin="10,0,10,10" Background="#FFF0F0F0" Height="32" VerticalAlignment="Bottom">
            <ProgressBar x:Name="ProgressBar" Margin="10,10,0,10" HorizontalAlignment="Left" Width="100" />
            <Label x:Name="InfoBar" Margin="115,0,0,0" />
        </Grid>
    </Grid>
</Window>